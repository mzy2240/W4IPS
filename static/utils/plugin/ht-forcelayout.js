!function(y,t){"use strict";var I="ht",Y=I+".layout.",F=y[I]||module.parent.exports.ht,P=F.List,K=F.DataModel,A=F.Node,L=F.Edge,d=F.Group,O=Math,B=O.sqrt,M=O.random,n=O.max,W=O.min,u=function(K){return K*K};F.Default.getInternal().addMSMap({ms_force:function(s){s._interval=50,s._stepCount=10,s._motionLimit=.01,s._edgeRepulsion=.65,s._nodeRepulsion=.65,s._damper=1,s._maxMotion=0,s._motionRatio=0,s.init=function(v){var r=this;v instanceof K?r.dm=v:r.gv=v,r._nodeMap={},r._nodes=new P,r._edges=new P},s.start=function(){var F=this,t=F.gv;if(!F._timer){var U=F.cdm=t?t.dm():F.dm;U.mm(F.handleDataModelChange,F),U.md(F.handleDataPropertyChange,F),t&&t.mp(F.handleGV,F),U.each(function(U){if(F.isVisible(U)&&F.isLayoutable(U)&&U instanceof A)if(F instanceof k){var t=U.p3();U.p3([t[0]+M(),t[1]+M(),t[2]+M()])}else t=U.p(),U.p(t.x+M(),t.y+M())}),F._timer=setInterval(function(){F.relax()},F._interval),F._damper=1}},s.stop=function(){var j=this;j._timer&&(j.cdm.umm(j.handleDataModelChange,j),j.cdm.umd(j.handleDataPropertyChange,j),j.gv&&j.gv.ump(j.handleGV,j),clearInterval(j._timer),delete j._timer,delete j.cdm)},s.handleGV=function(L){var i=this;if("dataModel"===L.property){var x=L.oldValue,Y=L.newValue;x&&(x.umm(i.handleDataModelChange,i),x.umd(i.handleDataPropertyChange,i)),this.cdm=Y,Y.mm(i.handleDataModelChange,i),Y.md(i.handleDataPropertyChange,i)}},s.relax=function(){var T=this;if(!(T._damper<.1&&T._maxMotion<T._motionLimit)){this.cdm.each(function(U){T.isVisible(U)&&(U instanceof L?T.addEdge(U):U instanceof A&&T.addNode(U))});for(var $,M,k=0,Q=T._edges,E=T._nodes,N=E.size();k<T._stepCount;k++){for(Q.each(T.relaxEdge,T),$=0;N>$;$++)for(M=0;N>M;M++)T.relaxNode(E.get($),E.get(M));T.moveNode()}T._isAdjusting=1,E.each(function(b){b.fix||(b.p?b.v.p3(b.p):b.v.p(b.x,b.y))}),delete T._isAdjusting,T._nodeMap={},E.clear(),Q.clear(),T.onRelaxed()}},s.onRelaxed=function(){},s.isRunning=function(){return!!this._timer},s.isVisible=function(n){return n.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(n):!0},s.isLayoutable=function(O){if(O.s("layoutable")===!1)return!1;if(O instanceof d)return!1;var L=this;return L.gv?L.gv.isMovable(O)&&!L.gv.isSelected(O):!(L.cdm||L.dm).sm().co(O)},s.getNodeRepulsion=function(){return this._nodeRepulsion},s.setNodeRepulsion=function(o){this._nodeRepulsion=o,this._damper=1},s.getEdgeRepulsion=function(){return this._edgeRepulsion},s.setEdgeRepulsion=function(y){this._edgeRepulsion=y,this._damper=1},s.getStepCount=function(){return this._stepCount},s.setStepCount=function(R){this._stepCount=R,this._damper=1},s.getInterval=function(){return this._interval},s.setInterval=function(b){var q=this;q._interval!==b&&(q._interval=b,q._timer&&(clearInterval(q._timer),q._timer=setInterval(function(){q.relax()},b)))},s.handleDataPropertyChange=function(E){!this._isAdjusting&&this.isVisible(E.data)&&(this._damper=1)},s.handleDataModelChange=function(){this._damper=1},s.damp=function(){var x=this._maxMotion,u=this._damper;this._motionRatio<=.001&&((.2>x||x>1&&.9>u)&&u>.01?this._damper-=.01:.4>x&&u>.003?this._damper-=.003:u>1e-4&&(this._damper-=1e-4)),x<this._motionLimit&&(this._damper=0)}}}),F.layout.ForceLayout=function(h){this.init(h)},F.Default.def(Y+"ForceLayout",t,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(y){this._limitBounds=y,this._damper=1},getNodeSize:function(U){var m=this.gv;return m&&m.getDataUIBounds?m.getDataUIBounds(U):U.getRect()},addNode:function(H){var S=this,V=S._nodeMap[H._id];if(V)return V;var Z=H.p();V={v:H,x:Z.x,y:Z.y,dx:0,dy:0,fix:!S.isLayoutable(H),s:S.getNodeSize(H)};var Q=V.s,g=B(u(Q.width)+u(Q.height))*S._nodeRepulsion;return V.r=1>g?100:g,S._nodeMap[H._id]=V,S._nodes.add(V),V},addEdge:function(H){if(H._40I&&H._41I){var x=this,D=x.addNode(H._40I),C=x.addNode(H._41I),b={s:D,t:C};C=C.s,D=D.s;var i=C.width+D.width,z=C.height+D.height;b.length=B(i*i+z*z)*x._edgeRepulsion,b.length<=0&&(b.length=100),x._edges.add(b)}},relaxEdge:function(D){var K=D.t,H=D.s,J=K.x-H.x,y=K.y-H.y,z=B(J*J+y*y),w=100*D.length,Y=.25*J/w*z,v=.25*y/w*z;K.dx=K.dx-Y,K.dy=K.dy-v,H.dx=H.dx+Y,H.dy=H.dy+v},relaxNode:function(I,d){if(I!==d){var g=0,h=0,$=I.x-d.x,G=I.y-d.y,F=$*$+G*G;0===F?(g=M(),h=M()):36e4>F&&(g=$/F,h=G/F);var e=I.r*d.r/400;g*=e,h*=e,I.dx+=g,I.dy+=h,d.dx-=g,d.dy-=h}},moveNode:function(){var C=this,g=C._limitBounds,t=C._maxMotion,U=0,z=C._damper;C._nodes.each(function(v){if(!v.fix){var o=v.dx*z,K=v.dy*z;if(v.dx=o/2,v.dy=K/2,U=n(B(o*o+K*K),U),v.x+=n(-40,W(40,o)),v.y+=n(-40,W(40,K)),g){v.x<g.x&&(v.x=g.x,C.adjust(1,0)),v.y<g.y&&(v.y=g.y,C.adjust(0,1));var L=v.s;v.x+L.width>g.x+g.width&&(v.x=g.x+g.width-L.width,C.adjust(-1,0)),v.y+L.height>g.y+g.height&&(v.y=g.y+g.height-L.height,C.adjust(0,-1))}}}),C._maxMotion=U,C._motionRatio=U>0?t/U-1:0,C.damp()},adjust:function(J,M){var X=this._limitBounds;this._nodes.each(function(p){J>0?(!X||p.x+p.s.width+J<X.x+X.width)&&(p.x+=J):(!X||p.x+J>X.x)&&(p.x+=J),M>0?(!X||p.y+p.s.height+M<X.y+X.height)&&(p.y+=M):(!X||p.y+M>X.y)&&(p.y+=M)})}});var k=F.layout.Force3dLayout=function(k){this.init(k)};F.Default.def(Y+"Force3dLayout",t,{ms_force:1,getNodeSize3d:function(F){return F.s3()},addNode:function(g){var s=this,O=s._nodeMap[g._id];if(O)return O;O={v:g,p:g.p3(),d:[0,0,0],fix:!s.isLayoutable(g),s:s.getNodeSize3d(g)};var z=O.s,i=F.Default.getDistance(z)*s._nodeRepulsion;return O.r=1>i?100:i,s._nodeMap[g._id]=O,s._nodes.add(O),O},addEdge:function(H){if(H._40I&&H._41I){var t=this,q=t.addNode(H._40I),O=t.addNode(H._41I),P={s:q,t:O};O=O.s,q=q.s,P.length=B(u(O[0]+q[0])+u(O[1]+q[1])+u(O[2]+q[2]))*t._edgeRepulsion,P.length<=0&&(P.length=100),t._edges.add(P)}},relaxEdge:function(C){var m=C.t.p,V=C.s.p,P=C.t.d,F=C.s.d,U=m[0]-V[0],Z=m[1]-V[1],d=m[2]-V[2],S=B(U*U+Z*Z+d*d),h=100*C.length,p=.25*U/h*S,Y=.25*Z/h*S,T=.25*d/h*S;P[0]-=p,P[1]-=Y,P[2]-=T,F[0]+=p,F[1]+=Y,F[2]+=T},relaxNode:function(A,L){if(A!==L){var d=A.p,e=L.p,P=0,c=0,q=0,O=d[0]-e[0],B=d[1]-e[1],D=d[2]-e[2],H=O*O+B*B+D*D;0===H?(P=M(),c=M(),q=M()):216e6>H&&(P=O/H,c=B/H,q=D/H);var a=A.r*L.r/400,J=A.d,m=L.d;P*=a,c*=a,q*=a,J[0]+=P,J[1]+=c,J[2]+=q,m[0]-=P,m[1]-=c,m[2]-=q}},moveNode:function(){var O=this,i=O._maxMotion,A=0,M=O._damper;O._nodes.each(function(q){if(!q.fix){var z=q.p,N=q.d,T=N[0]*M,Y=N[1]*M,e=N[2]*M;N[0]=T/2,N[1]=Y/2,N[2]=e/2,A=n(B(T*T+Y*Y+e*e),A),z[0]+=n(-40,W(40,T)),z[1]+=n(-40,W(40,Y)),z[2]+=n(-40,W(40,e))}}),O._maxMotion=A,O._motionRatio=A>0?i/A-1:0,O.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);