!function(K,F){"use strict";var n=ht.AlarmSeverity=function(B,F,x,m,q){this.value=B,this.name=F,this.nickName=x,this.color=m,this.displayName=q};ht.Default.def("ht.AlarmSeverity",F,{toString:function(){return this.displayName||this.name}}),function(){n.severities=new ht.List,n._vm={},n._nm={},n._cp=function(b,H){if(b&&H){var z=b.value-H.value;return z>0?1:0>z?-1:0}return b&&!H?1:!b&&H?-1:0},n.each=function($,h){n.severities.each($,h)},n.getSortFunction=function(){return n._cp},n.setSortFunction=function(M){n._cp=M,n.severities.sort(M)},n.add=function(V,C,m,L,b){var J=new n(V,C,m,L,b);return n._vm[V]=J,n._nm[C]=J,n.severities.add(J),n.severities.sort(n._cp),J},n.remove=function(S){var h=n._nm[S];return h&&(delete n._nm[S],delete n._vm[h.value],n.severities.remove(h)),h},n.CRITICAL=n.add(500,"Critical","C","#FF0000"),n.MAJOR=n.add(400,"Major","M","#FFA000"),n.MINOR=n.add(300,"Minor","m","#FFFF00"),n.WARNING=n.add(200,"Warning","W","#00FFFF"),n.INDETERMINATE=n.add(100,"Indeterminate","N","#C800FF"),n.CLEARED=n.add(0,"Cleared","R","#00FF00"),n.isClearedAlarmSeverity=function(Y){return Y?0===Y.value:!1},n.getByName=function(s){return n._nm[s]},n.getByValue=function(r){return n._vm[r]},n.clear=function(){n.severities.clear(),n._vm={},n._nm={}},n.compare=function(X,t){return n._cp(X,t)}}();var U=ht.AlarmState=function(S){this._d=S,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",F,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var S=null;for(var $ in this._am)$=n.getByName($),n.isClearedAlarmSeverity($)||0!==this.getAcknowledgedAlarmCount($)&&(S=S?n.compare(S,$)>0?S:$:$);this._haa=S},_c2:function(){var $=null;for(var R in this._nm)R=n.getByName(R),n.isClearedAlarmSeverity(R)||0!==this.getNewAlarmCount(R)&&($=$?n.compare($,R)>0?$:R:R);this._hna=$},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var x in this._nm)if(x=n.getByName(x),!n.isClearedAlarmSeverity(x)&&0!==this.getNewAlarmCount(x)&&n.compare(this._hna,x)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var V=this._haa,F=this._hna,T=this._ps;this._hoa=V,n.compare(F,this._hoa)>0&&(this._hoa=F),n.compare(T,this._hoa)>0&&(this._hoa=T)},_c5:function(){var E=this._haa,X=this._hna;this._hta=E,n.compare(X,this._hta)>0&&(this._hta=X)},increaseAcknowledgedAlarm:function(I,R){if(0!==R){R=R||1;var Z=this._am[I.name]||0;Z+=R,this._am[I.name]=Z,this._f()}},increaseNewAlarm:function(o,F){if(0!==F){F=F||1;var R=this._nm[o.name]||0;R+=F,this._nm[o.name]=R,this._f()}},decreaseAcknowledgedAlarm:function(O,M){if(0!==M){M||(M=1);var G=this._am[O.name]||0;if(G-=M,0>G)throw"Alarm count can not be negative";this._am[O.name]=G,this._f()}},decreaseNewAlarm:function(H,$){if(0!==$){$||($=1);var C=this._nm[H.name]||0;if(C-=$,0>C)throw"Alarm count can not be negative";this._nm[H.name]=C,this._f()}},acknowledgeAlarm:function($){this.decreaseNewAlarm($,1),this.increaseAcknowledgedAlarm($,1)},acknowledgeAllAlarms:function(p){if(p){var $=this.getNewAlarmCount(p);this.decreaseNewAlarm(p,$),this.increaseAcknowledgedAlarm(p,$)}else for(var J in this._nm)this.acknowledgeAllAlarms(n.getByName(J))},_c6:function(){this._aac=0;for(var q in this._am)q=n.getByName(q),this._aac+=this.getAcknowledgedAlarmCount(q)},getAcknowledgedAlarmCount:function(G){return G?this._am[G.name]||0:this._aac},getAlarmCount:function(L){return this.getAcknowledgedAlarmCount(L)+this.getNewAlarmCount(L)},_c7:function(){this._nac=0;for(var R in this._nm)this._nac+=this.getNewAlarmCount(n.getByName(R))},getNewAlarmCount:function(V){return V?this._nm[V.name]||0:this._nac},setNewAlarmCount:function(k,W){this._nm[k.name]=W,this._f()},removeAllNewAlarms:function(N){N?delete this._nm[N]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(U,S){this._am[U.name]=S,this._f()},removeAllAcknowledgedAlarms:function(N){N?delete this._am[N.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(i){if(this._ep||(i=null),this._ps!==i){var I=this._ps;this._ps=i,this._f(),this._d.fp("propagateSeverity",I,i)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(R){var L=this._ep;this._ep=R,this._d.fp("enablePropagation",L,R)&&(R||this.setPropagateSeverity(null))}});var H=ht.AlarmStatePropagator=function(l){this._dataModel=l,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",F,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(e){this._enable!==e&&(this._enable=e,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(n){this.propagate(n)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(T){T.data&&this.propagate(T.data)},handleDataPropertyChange:function(X){if("alarmState"===X.property||"enablePropagation"===X.property)this.propagate(X.data);else if("parent"===X.property){var m=X.oldValue;m&&this.propagate(m),this.propagate(X.data)}},propagate:function(b){b&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(b),this._isPropagating=!1)},propagateToTop:function(m){for(this.propagateToParent(null,m);m&&m.getParent();)this.propagateToParent(m,m.getParent()),m=m.getParent()},propagateToParent:function(p,h){var P=null;h.getChildren().each(function(t){var B=t.getAlarmState().getHighestOverallAlarmSeverity();n.compare(B,P)>0&&(P=B)}),h.getAlarmState().setPropagateSeverity(P)}}),ht.AlarmStateStatistics=function(k){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(k)},ht.Default.def("ht.AlarmStateStatistics",F,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(n){var w=this._dataModel;w!==n&&(w&&(w.umd(this.handleDataPropertyChange,this),w.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=n,this.reset(),n.md(this.handleDataPropertyChange,this),n.mm(this.handleDataModelChange,this),this.fp("dataModel",w,n))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(n){"alarmState"===n.property&&(this.increase(n.data),this.fireAlarmStateChange())},handleDataModelChange:function(v){"add"===v.kind?(this.increase(v.data),this.fireAlarmStateChange()):"remove"===v.kind?(this.decrease(v.data),this.fireAlarmStateChange()):"clear"===v.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,n.each(function(x){var o=this.getSumInfo(x);this.sumAcked+=o.ackedCount,this.sumNew+=o.newCount,this.sumTotal+=o.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(F){if(!F)return this.sumNew;var H=this.getSumInfo(F);return H.newCount},getAcknowledgedAlarmCount:function(b){if(!b)return this.sumAcked;var T=this.getSumInfo(b);return T.ackedCount},getTotalAlarmCount:function(b){if(!b)return this.sumTotal;var x=this.getSumInfo(b);return x.totalCount},getSumInfo:function(p){var X=this.severtiyMap[p.name];return X||(X={},X.newCount=0,X.ackedCount=0,X.totalCount=0,this.severtiyMap[p.name]=X),X},decrease:function(e){var f=this.dataMap[e.getId()];f&&(delete this.dataMap[e.getId()],n.each(function(s){var K=f[s.name],h=this.getSumInfo(s);h.newCount=h.newCount-K.newCount,h.ackedCount=h.ackedCount-K.ackedCount,h.totalCount=h.totalCount-K.totalCount},this))},increase:function(u){if(this.decrease(u),!this._filterFunc||this._filterFunc(u)){var s={},S=u.getAlarmState();this.dataMap[u.getId()]=s,n.each(function(K){var w={};w.newCount=S.getNewAlarmCount(K),w.ackedCount=S.getAcknowledgedAlarmCount(K),w.totalCount=S.getAlarmCount(K),s[K.name]=w;var O=this.getSumInfo(K);O.newCount=O.newCount+w.newCount,O.ackedCount=O.ackedCount+w.ackedCount,O.totalCount=O.totalCount+w.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(T){var K=this._filterFunc;this._filterFunc=T,this.reset(),this.fp("filterFunc",K,T)},getFilterFunc:function(){return this._filterFunc}});var t=ht.Data.prototype;t.getAlarmState=function(){return this._alarmState||(this._alarmState=new U(this))},t=ht.DataModel.prototype,t.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},t.setEnableAlarmStatePropagator=function(x){x!=this.isEnableAlarmStatePropagator()&&(x?(this._alarmStatePropagator=new H(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},t=ht.graph.GraphView.prototype,t.getNote2=function(S){var M=S.getAlarmState().getHighestNewAlarmSeverity();if(M){var l=S.getAlarmState().getNewAlarmCount(M)+M.nickName;return S.getAlarmState().hasLessSevereNewAlarms()&&(l+="+"),l}return S.s("note2")},t.getNote2Background=function(y){var o=y.getAlarmState().getHighestNewAlarmSeverity();return o?o.color:y.s("note2.background")},t.getBodyColor=function(O){var s=O.getAlarmState().getHighestNativeAlarmSeverity();return s?s.color:O.s("body.color")},t.getBorderColor=function(e){var S=e.getAlarmState().getPropagateSeverity();return S?S.color:e.s("border.color")},t=ht.widget.TreeView.prototype,t.getBorderColor=function(q){var y=q.getAlarmState().getPropagateSeverity();return y?y.color:q.s("border.color")},t.getIcon=function(k){return k.getIcon()?"__alarmIcon__":null},t=ht.widget.TreeTableView.prototype,t.getBorderColor=function(X){var s=X.getAlarmState().getPropagateSeverity();return s?s.color:X.s("border.color")},t.getIcon=function(b){return b.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(X){return X.getIcon()}},color:{func:function(q){var k=q.getAlarmState().getHighestNativeAlarmSeverity();return k?k.color:q.s("body.color")}},rect:[0,0,16,16]}]});var m=ht.Style;m["note2.expanded"]=!0,m["note2.color"]="#000"}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);