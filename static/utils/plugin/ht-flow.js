!function(B){"use strict";var Y=B.ht,t=Y.Default,W=t.getInternal(),O=W.ui(),i=null,H="__segmentLengths",V="__lineTotalLength",x="__linePoints",z="__distance0",p="flow.count",c="flow.step",b="flow.element.max",j="flow.element.count",Q="flow.element.min",d="flow.element.space",F="flow.element.autorotate",Z="flow.element.background",L="flow.element.shadow.max",G="flow.element.shadow.min",g="flow.element.shadow.begincolor",v="flow.element.shadow.endcolor",A="flow.element.shadow.visible",a="flow.element.image",J="flow",_=Y.Math.Vector2,q=new _;new _,new _;var l=Y.List,y=function(s,Z,N,F,B,d){var V,T,m,j,O,J,i,c,G,r,Y,R=[];if(Math.abs(F)>2*Math.PI&&(F=2*Math.PI),O=Math.ceil(Math.abs(F)/(Math.PI/4)),V=F/O,T=-V,m=-N,O>0){J=s+Math.cos(N)*B,i=Z+Math.sin(-N)*d,R.push({x:J,y:i});for(var b=0;O>b;b++)m+=T,j=m-T/2,c=s+Math.cos(m)*B,G=Z+Math.sin(m)*d,r=s+Math.cos(j)*(B/Math.cos(T/2)),Y=Z+Math.sin(j)*(d/Math.cos(T/2)),R.push({x:r,y:Y}),R.push({x:c,y:G})}return R},f=function(M){if(M){var i=M._data;if(i instanceof Y.Shape)return{points:i.getPoints(),segments:i.getSegments()};var K;if(i instanceof Y.Edge&&(K=M._78o)){var f,V,D=K.type,X=K.points,u=K.segments,e=K.edgeTypeInfo;if(!D||X){var R=K.sourcePoint,g=R.x,U=R.y,j=K.targetPoint,I=j.x,L=j.y;if(D)u?(f=new l({x:g,y:U}),f.addAll(X),f.add({x:I,y:L}),V=new l(u._as)):(f=new l({x:g,y:U}),X.each(function(d){f.add(d)}),f.add({x:I,y:L}));else if(K.looped){f=new l(y(g,U,0,2*Math.PI,K.radius,K.radius)),V=new l([1]);for(var a=0;a<(f.size()-1)/2;a++)V.add(3)}else f=new l,K.center?(f.add({x:K.c1.x,y:K.c1.y}),f.add({x:g,y:U}),f.add({x:I,y:L}),f.add({x:K.c2.x,y:K.c2.y})):(f.add({x:g,y:U}),f.add({x:I,y:L}))}else e&&(f=new l(e.points._as),e.segments&&(V=new l(e.segments._as)));return{points:f,segments:V}}}},m=function(e,C,z){if(null==C){var H=f(e);if(!H)return;C=H.points,z=H.segments}if(C){if(Array.isArray(C)&&(C=new l(C)),"number"==typeof C.get(0)){for(var I=new Y.List,U=0;U<C.size();U+=2)I.add({x:C.get(U),y:C.get(U+1)});C=I}if(!z){z=[1];for(var c=C.length-1;c>0;c--)z.push(2)}Array.isArray(z)&&(z=new l(z));for(var t=W.toPointsArray(C._as,z._as,50),p=t.length,O=[],U=0;p>U;U++){var S=t[U];S.length>1&&O.push(S)}return O}},N=function(Z,y){for(var P=[],H=Z.length,S=0;H>S;S++){var I=Z[S];I._as&&(I=I._as);for(var a=I[0],Q=1;Q<I.length;Q++)P.push([a,I[Q]]),a=I[Q]}for(var g=[],S=0;S<P.length;S++){var w=n(P[S][0],P[S][1],y);g.push(w)}return{distance:g,segments:P}},k=function(q,_,h){if(q){for(var r,K=N(q,_),z=K.distance,R=K.segments,Y=1/0,c=null,f=0,s=z.length;s>f;f++){var e=z[f];e.z<Y&&(r=f,Y=e.z,c=e)}if(null==h&&(h=.1),c.z<h){for(var Q=0,X=0;r>=X;X++)Q+=t.getDistance(R[X][0],r>X?R[X][1]:c);return Q}}},n=function(D,f,T){var i=D.x,A=D.y,b=f.x,_=f.y,w=T.x,N=T.y,s=b-i,t=_-A,l=Math.sqrt(s*s+t*t),L=s/l,U=t/l,K=(-i+w)*L+(-A+N)*U,J={x:i+K*L,y:A+K*U};return J.x>=Math.min(D.x,f.x)&&J.x<=Math.max(D.x,f.x)&&J.y>=Math.min(D.y,f.y)&&J.y<=Math.max(D.y,f.y)||(J.x=Math.abs(J.x-D.x)<Math.abs(J.x-f.x)?D.x:f.x,J.y=Math.abs(J.y-D.y)<Math.abs(J.y-f.y)?D.y:f.y),s=w-J.x,t=N-J.y,J.z=Math.sqrt(s*s+t*t),J},P=function(K,R){if(K){var W=N(K,R).distance,g=1/0,u=null;return W.forEach(function(i){i.z<g&&(g=i.z,u=i)}),u}},w=function(d){for(var G=0,M=d.length-1,H=0;M>H;H++){var C=d[H],I=d[H+1],m=I.x-C.x,h=I.y-C.y;G+=Math.sqrt(m*m+h*h)}return G},U=function(p,T){for(var A=0,y=T.length,G=0;y>G;G++){var x=T[G];if(A+=x,A>p)return G}return Math.min(G,y-1)},e=function(n,Z){for(var t=0,K=0,O=0,e=n.length-1,q=0;e>q;q++){var Q=n[q],V=n[q+1],u=V.x-Q.x,y=V.y-Q.y;if(O=Math.sqrt(u*u+y*y),t+=O,t>Z){t-=O,K=q;break}}var J=n[K],w=n[K+1],f=Math.atan2(w.y-J.y,w.x-J.x),I=Z-t,y=Math.sin(f)*I,u=Math.cos(f)*I;return{x:J.x+u,y:J.y+y}},r=function(O,F,V){if(!O)return V;if(0===F){var $=O[0][0],Q=O[0][1];return V+Math.atan2(Q.y-$.y,Q.x-$.x)}if(100===F){O=O[O.length-1];var $=O[O.length-2],Q=O[O.length-1];return V+Math.atan2(Q.y-$.y,Q.x-$.x)}for(var b=0,S=[],M=O.length,T=0;M>T;T++){var k=O[T],q=w(k);b+=q,S.push(q)}for(var y=b*F/100,n=U(y,S),L=0,d=0;n>d;d++)L+=S[d];y-=L;for(var o=e(O[n],y),h=O[n],C=0,s=0,N=0;N<h.length-1;N++){var i=h[N],c=h[N+1],t=c.x-i.x,Y=c.y-i.y,_=Math.sqrt(t*t+Y*Y);if(C+=_,C>y){s=N;break}}var j=h[s];return V+Math.atan2(o.y-j.y,o.x-j.x)},u=function(h){var M=0;if(h)if(Array.isArray(h[0]))for(var z=h.length,Y=0;z>Y;Y++){var T=h[Y],v=w(T);M+=v}else M=w(h);return M},S=function(V,r,I,t){return q.set(r,I).rotateAround(null,t),V?{x:V.x+q.x,y:V.y+q.y}:{x:q.x,y:q.y}},K=function(K){var l=K._data,N=m(K);if(N){l.s("flow.reverse")&&(N.reverse(),N.forEach(function(m){m.reverse()}));for(var X=0,M=[],P=N.length,f=0;P>f;f++){var p=N[f],T=w(p);X+=T,M.push(T)}if(l[H]=M,l[V]=X,l[x]=N,l instanceof Y.Edge){var S=t.unionPoint(N),b=S.x+S.width/2,C=S.y+S.height/2;l.$10e={x:b,y:C}}R(K,!0)}},X=function(G,t){if(G){var R;if(0===t)R=G[0][0];else if(100===t)G=G[G.length-1],R=G[G.length-1];else{for(var H=0,q=[],Y=G.length,f=0;Y>f;f++){var v=G[f],C=w(v);H+=C,q.push(C)}for(var h=H*t/100,D=U(h,q),E=0,$=0;D>$;$++)E+=q[$];h-=E,R=e(G[D],h)}return R}},R=function(L,w){var J=L._data,Y=J[V],t=J.s(p),Z=J.s(c),m=0,T=J[H],W=J.s(b),i=J.s(Q),q=J.s(j),A=(W-i)/(q-1),u=[];if(T){if(1===q)u.push(W);else if(2===q)u.push(W),u.push(i);else{if(!(q>2))return;u.push(W);for(var y=q-2;y>0;y--)u.push(i+A*y);u.push(i)}var N=0,U=0;u.forEach(function(K){q-1>N&&(U+=J.getFlowElementSpace(K)),N++}),U+=(W+i)/2,m=(Y-t*U+U)/t;var g=L[z];for(null==g&&(g=0),w||(g+=Z);g>Y+U;){var E=L._overCount;E?E++:E=1,E>=t&&(E=null),L._overCount=E,J.s("flow.autoreverse")?E?g-=m+U:(g=0,J.s("flow.reverse",!J.s("flow.reverse"))):g-=m+U}L[z]=g}},D="prototype",o=Y.graph.GraphView[D],s=Y.Data[D],I=O.DataUI[D],h=O.ShapeUI[D],M=O.EdgeUI[D],C=Y.DataModel[D],$=Y.Style;$[b]==i&&($[b]=7),$[Q]==i&&($[Q]=0),$[p]==i&&($[p]=1),$[c]==i&&($[c]=3),$[j]==i&&($[j]=10),$[d]==i&&($[d]=3.5),$[F]==i&&($[F]=!1),$[Z]==i&&($[Z]="rgba(255, 255, 114, 0.4)"),$[g]==i&&($[g]="rgba(255, 255, 0, 0.3)"),$[v]==i&&($[v]="rgba(255, 255, 0, 0)"),$[A]==i&&($[A]=1),$[L]==i&&($[L]=22),$[G]==i&&($[G]=4),o.calculatePointLength=function(v,b,L){var t=this.getDataUI(v),G=m(t);return k(G,b,L)},t.calculatePointLength=function(o,W,w,q){var X=m(i,o,W);return k(X,w,q)},t.calculateClosestPointOnLine=n,o.calculateClosestPoint=function(N,C){var y=this.getDataUI(N),K=m(y);return P(K,C)},t.calculateClosestPoint=function($,u,S){var d=m(i,$,u);return P(d,S)},o.getPercentAngle=function(Z,z){var S=this.getDataUI(Z),g=m(S);return Z.getRotation?Z.getRotation():0,r(g,z,Z.getRotation?Z.getRotation():0)},t.getPercentAngle=function(M,j,t){var C=m(i,M,j);return r(C,t,0)},o.calculateLength=function(b){var K=this.getDataUI(b),S=m(K);return u(S)},t.calculateLength=function(I,N){var K=m(i,I,N);return u(K)},o.getPercentPosition=function(M,H){var I=this.getDataUI(M),r=m(I);return X(r,H)},t.getPercentPositionOnPoints=function(I,s,t){var G=m(i,I,s);return X(G,t)};var T=function(_){var L=_.data,W=this.dm();if(L&&"add"===_.kind){var A=W.$3e;A&&L.s(J)&&A.indexOf(L)<0&&A.push(L)}"clear"===_.kind&&(W.$3e=[])},E=function(Y){var x=Y.property,B=Y.data,G=Y.newValue,h=this.dm().$3e;if(h&&"s:flow"===x)if(G)h.indexOf(B)<0&&h.push(B);else for(var L=h.length,w=0;L>w;w++)if(h[w]===B){h.splice(w,1);break}},nr=o.setDataModel;o.setDataModel=function(Z){var R=this,B=R._dataModel;if(B!==Z){B&&(B.umm(T,R),B.umd(E,R),B.$3e=[]),Z.mm(T,R),Z.md(E,R);var C=Z.$3e=[];Z.each(function(i){i.s(J)&&C.indexOf(i)<0&&C.push(i)}),nr.call(R,Z)}},s.getFlowElementSpace=function(){return this.s(d)};var Bg=function(l){var J=this,r=J._data,N=r[V],I=r[H],A=r[x],E=r.s(p),d=0,h=J[z],O=r.s(b),Z=r.s(Q),R=r.s(j),Y=r.s(G),B=r.s(L),f=r.s(F),$=(B-Y)/(R-1),v=(O-Z)/(R-1),C=r.getRotation?r.getRotation():0,g=r.getPosition?r.p():r.$10e,X=[],y=[];if(h!=i){if(1===R)X.push(O);else if(2===R)X.push(O),X.push(Z);else{if(!(R>2))return;X.push(O);for(var T=R-2;T>0;T--)X.push(Z+v*T);X.push(Z)}if(1===R)y.push(B);else if(2===R)y.push(B),y.push(Y);else{if(!(R>2))return;y.push(B);for(var T=R-2;T>0;T--)y.push(Y+$*T);y.push(Y)}var P=0,n=0;X.forEach(function(t){R-1>P&&(n+=r.getFlowElementSpace(t)),P++}),n+=(O+Z)/2,d=(N-E*n+n)/E,l.save();for(var T=0;E>T;T++){var W=h,o=0,w=J._overCount,m=0;r.s("flow.autoreverse")&&w&&w>E-(T+1)||(W-=T*(d+n),P=0,X.forEach(function(T){var k=W-o;if(k>=0&&N>k){var K=!0,s=U(k,I);m=0;for(var i=0;s>i;i++)m+=I[i];if(k-=m,K){var E=e(A[s],k),v=C;if(f){for(var x=A[s],_=0,p=0,c=0;c<x.length-1;c++){var $=x[c],H=x[c+1],h=H.x-$.x,a=H.y-$.y,R=Math.sqrt(h*h+a*a);if(_+=R,_>k){p=c;break}}var j=x[p];v+=Math.atan2(E.y-j.y,E.x-j.x)}C&&(E=S(g,E.x-g.x,E.y-g.y,C)),J.$5e(l,E,T,y[P],v)}}o+=r.getFlowElementSpace(X[P]),P++}))}l.restore()}},Ci=M._80o;M._80o=function(w){Ci.call(this,w);var r=this,o=r._data,X=r.gv;o.s(J)&&X.$7e!=i&&Bg.call(r,w)};var _n=h._80o;h._80o=function(m){_n.call(this,m);var O=this,Z=O._data,E=O.gv;Z.s(J)&&E.$7e!=i&&Bg.call(O,m)};var kc=M._79o,sd=h._79o,up=function(){var S=this,Z=S._data,M=Z.s(b),j=!1,e=i;if(S._6I||(j=!0),e=Z instanceof Y.Edge?kc.call(S):sd.call(S),Z.s(J)&&j){var B=Z.s(L),G=Z.s(A);G&&B>M&&(M=B),M>0&&t.grow(e,Math.ceil(M/2)),K(S)}return!Z.s(J)&&j&&(Z[H]=Z[V]=Z[x]=S[z]=i),e};h._79o=up,M._79o=up,I.$5e=function(T,O,D,n,B){var o=this,c=o._data,U=o.gv,j=c.s(Z),N=c.s(g),S=c.s(v),Y=c.s(A),y=U.$8e,p=c.s(a);if(y==i&&(y=U.$8e={}),T.beginPath(),p!=i){var C=t.getImage(p),G=D/2;T.translate(O.x,O.y),T.rotate(B),T.translate(-O.x,-O.y),t.drawImage(T,C,O.x-G,O.y-G,D,D,c),T.translate(O.x,O.y),T.rotate(-B),T.translate(-O.x,-O.y)}else if(U.__flowBatch){var r=U.__flowBatchGroup;r||(r=U.__flowBatchGroup={});var K=[O.x,O.y,D/2];r[j]?r[j].push(K):r[j]=[K]}else T.fillStyle=j,T.arc(O.x,O.y,D/2,0,2*Math.PI,!0),T.fill();if(Y){var z=22,w=z+"_"+N+"_"+S,b=y[w];if(b==i){var u=document.createElement("canvas");W.setCanvas(u,z,z);var l=u.getContext("2d"),H=z/2,q=H,F=H;W.translateAndScale(l,0,0,1),l.beginPath();var d=l.createRadialGradient(q,F,0,q,q,H);d.addColorStop(0,N),d.addColorStop(1,S),l.fillStyle=d,l.arc(q,F,H,0,2*Math.PI,!0),l.fill(),b=y[w]=u}var G=n/2;t.drawImage(T,b,O.x-G,O.y-G,n,n,c)}},o.$9e=function(){var J=this,w=J.dm().$3e;J._24I,w.forEach(function(x){J._24I[x._id]=x}),J.iv()};var ug=C.prepareRemove;C.prepareRemove=function(I){ug.call(this,I);var w=I._dataModel,A=w.$3e;if(A)for(var h=A.length,$=0;h>$;$++)if(A[$]===I){A.splice($,1);break}},o.setFlowInterval=function(d){var R=this,Q=R.$11e;R.$11e=d,R.fp("flowInterval",Q,d),R.$7e!=i&&(clearInterval(R.$7e),delete R.$7e,R.enableFlow(d))},o.getFlowInterval=function(){return this.$11e},o.enableFlow=function(j){var N=this,$=N.dm(),b=$.$3e;N.$7e==i&&(b.forEach(function(q){var d=N.getDataUI(q);K(d)}),N.$7e=setInterval(function(){$.$3e.forEach(function(k){R(N.getDataUI(k))}),N.$9e()},j||N.$11e||50))},o.disableFlow=function(){var E=this;clearInterval(E.$7e),delete E.$7e;var d=E.dm().$3e;d&&E.$9e()};var Fc=function(){this.__flowBatchGroup={}},bn=function($){var T=this.__flowBatchGroup;if(T){$.save();for(var Q in T){$.fillStyle=Q,$.beginPath();var j=T[Q];j.forEach(function(y){$.moveTo(y[0],y[1]),$.arc(y[0],y[1],y[2],0,2*Math.PI,!0)}),$.fill()}$.restore()}};o.setFlowBatch=function(q){var M=this;!!M.__flowBatch!=!!q&&(M.__flowBatch=q,q?(M.addBottomPainter(Fc),M.addTopPainter(bn)):(M.removeBottomPainter(Fc),M.removeTopPainter(bn)))}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);